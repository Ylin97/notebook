#  Windows å¹³å° C++ å¤„ç†ä¸­æ–‡å‘½ä»¤è¡Œå‚æ•°ä¸æ§åˆ¶å°è¾“å‡º â€”â€” æœ€ä½³å®è·µæ€»ç»“

> **é˜…è¯»ç›®çš„**ï¼šå¿«é€Ÿç†è§£ *ä¸ºä»€ä¹ˆæ§åˆ¶å°ä¼šä¹±ç *ï¼Œå¹¶æŒæ¡ **æœ€å®‰å…¨ã€æœ€é€šç”¨** çš„ç¼–ç å¤„ç†æ–¹æ¡ˆä¸æ¨¡æ¿ä»£ç ã€‚

------

## ğŸ’¥ èƒŒæ™¯é—®é¢˜

Windows å¹³å°ç¨‹åºç¼–ç å¤„ç†å¼‚å¸¸å¤æ‚ï¼šä¼ ç»Ÿæ§åˆ¶å°é»˜è®¤ä½¿ç”¨æœ¬åœ°ä»£ç é¡µï¼ˆACPï¼‰ï¼Œå¦‚ä¸­æ–‡ç³»ç»Ÿä¸º `GBK/CP936`ï¼Œè€Œç°ä»£å·¥å…·å¦‚ Windows Terminal åˆå¼ºåˆ¶ä½¿ç”¨ UTF-8ã€‚è¿™ä¸ç°ä»£ C++ ç¼–ç¨‹å’Œè·¨å¹³å°å¼€å‘æ™®éé‡‡ç”¨çš„ **UTF-8 ç¼–ç **ä¹ æƒ¯ç›¸å†²çªï¼Œå¯¼è‡´ä»¥ä¸‹å¸¸è§é—®é¢˜ï¼š

- å‘½ä»¤è¡Œå‚æ•°ä¸­åŒ…å«ä¸­æ–‡æ—¶ï¼Œå¯èƒ½ä¼šä¹±ç æˆ–æŠ›å¼‚å¸¸ï¼ˆä¾‹å¦‚ `std::filesystem` æŠ¥é”™ï¼‰ã€‚
- æ§åˆ¶å°è¾“å‡ºä¸­æ–‡æˆ– emoji æ—¶ä¹±ç ã€‚
- ç›´æ¥ä½¿ç”¨ `char* argv[]` å¾—åˆ°çš„ç¼–ç ä¸æ˜¯ UTF-8ã€‚

------

## âœ… æ¨èè§£å†³æ–¹æ¡ˆ

### âœ… æ–¹æ¡ˆä¸€ï¼šç»Ÿä¸€ä½¿ç”¨ UTF-8ï¼ˆæ¨èæ–¹å¼ï¼Œè·¨å¹³å°å‹å¥½ï¼‰

#### æ ¸å¿ƒåšæ³•ï¼š

- ä½¿ç”¨ `main` è€Œé `wmain`
- æ‰‹åŠ¨é€šè¿‡ `CommandLineToArgvW(GetCommandLineW())` è·å–å‚æ•°
- å°† `wchar_t*` å‚æ•°è½¬ä¸º UTF-8ï¼ˆ`std::string`ï¼‰
- è®¾ç½®æ§åˆ¶å°ä¸º UTF-8 æ¨¡å¼è¾“å‡º

#### ğŸ”§ å·¥å…·å¤´æ–‡ä»¶ `utf8_args.h`ï¼š

```cpp
#pragma once

#include <string>
#include <vector>

#if defined(_WIN32)
#include <windows.h>
#include <shellapi.h>
#include <iostream>

namespace utf8_args {

// å°†å®½å­—ç¬¦ä¸²è½¬æ¢ä¸º UTF-8 ç¼–ç çš„ std::stringã€‚æ³¨æ„ï¼šè¿”å›çš„å­—ç¬¦ä¸²ä¸åŒ…å« null terminatorï¼ˆå·²ç”± std::string ç®¡ç†ï¼‰
inline std::string WideToUTF8(const wchar_t* wstr) {
    int size = WideCharToMultiByte(CP_UTF8, 0, wstr, -1, nullptr, 0, nullptr, nullptr);
    if (size <= 0) return "";
    std::vector<char> buffer(size);
    WideCharToMultiByte(CP_UTF8, 0, wstr, -1, buffer.data(), size, nullptr, nullptr);
    return std::string(buffer.data());
}

// è·å– UTF-8 ç¼–ç çš„å‘½ä»¤è¡Œå‚æ•°ï¼ˆæ›¿ä»£ char* argv[]ï¼‰
inline std::vector<std::string> GetUTF8CommandLineArgs() {
    int argc = 0;
    wchar_t** argv_w = CommandLineToArgvW(GetCommandLineW(), &argc);
    std::vector<std::string> utf8_args;

    if (!argv_w) {
        fprintf(stderr, "[utf8_args] Failed to parse command line.\n");
        return utf8_args;
    }

    utf8_args.reserve(argc);
    for (int i = 0; i < argc; ++i) {
        utf8_args.emplace_back(WideToUTF8(argv_w[i]));
    }

    LocalFree(argv_w);
    return utf8_args;
}

} // namespace utf8_args

#else // é Windows å¹³å°

namespace utf8_args {
inline std::vector<std::string> GetUTF8CommandLineArgs(int argc, char* argv[]) {
    return std::vector<std::string>(argv, argv + argc);
}
} // namespace utf8_args

#endif
```

------

#### âœ¨ ç¤ºä¾‹ç”¨æ³•ï¼š

```cpp
#include "utf8_args.h"
#include <iostream>
#include <windows.h>

int main(int argc, char* argv[]) {
    // è®¾ç½®æ§åˆ¶å°è¾“å‡ºä¸º UTF-8ï¼ˆWindows 10+ æ”¯æŒï¼‰
    SetConsoleOutputCP(CP_UTF8);
    SetConsoleCP(CP_UTF8);

    auto args =
    #ifdef _WIN32
        utf8_args::GetUTF8CommandLineArgs();
    #else
        utf8_args::GetUTF8CommandLineArgs(argc, argv);
    #endif

    for (const auto& arg : args) {
        std::cout << arg << "\n";
    }

    return 0;
}
```

> ğŸ’¡ è¯·ç¡®ä¿æºä»£ç æ–‡ä»¶æœ¬èº«ä¹Ÿä½¿ç”¨ UTF-8 ç¼–ç ä¿å­˜ï¼ˆå¯å¸¦ BOM æˆ–ä¸å¸¦ï¼‰ï¼Œå¦åˆ™ä¸­æ–‡å­—é¢é‡å¯èƒ½å‡ºç°ä¹±ç ã€‚

> âš ï¸ å¦‚æœä½¿ç”¨ `std::filesystem::path` æ¥å¤„ç†è·¯å¾„ï¼Œè¯·ä½¿ç”¨ `std::filesystem::u8path(utf8_string)`ï¼Œé˜²æ­¢å› ç¼–ç é”™è¯¯å¯¼è‡´è·¯å¾„æ‰¾ä¸åˆ°ã€‚

------

### âœ… æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ `wmain` + å®½å­—ç¬¦æµï¼ˆWindows ä¸“å±ï¼‰

è¯¥æ–¹å¼ç”±æ“ä½œç³»ç»Ÿç›´æ¥ä¼ é€’å®½å­—ç¬¦å‚æ•°ï¼Œé€‚åˆå®Œå…¨åœ¨ Windows ä¸Šè¿è¡Œçš„ç¨‹åºï¼š

```cpp
#include <iostream>
#include <windows.h>
#include <fcntl.h>
#include <io.h>

int wmain(int argc, wchar_t* argv[]) {
    // è®¾ç½®æ§åˆ¶å°ä¸º UTF-8ï¼ˆç¡®ä¿æ˜¾ç¤ºæ­£ç¡®ï¼‰
    SetConsoleOutputCP(CP_UTF8);
    SetConsoleCP(CP_UTF8);

    // è®¾ç½® stdout ä¸ºå®½å­—ç¬¦ UTF-8 è¾“å‡ºæ¨¡å¼
    _setmode(_fileno(stdout), _O_U8TEXT);

    std::wcout << L"argc: " << argc << L"\n";
    for (int i = 0; i < argc; ++i) {
        std::wcout << L"argv[" << i << L"]: " << argv[i] << L"\n";
    }

    std::wcout << L"ä½ å¥½ï¼Œä¸–ç•Œï¼ğŸŒ\n";
    return 0;
}
```

> âœ… æ¨èé…åˆ `std::wcout`, `std::wcin` ä½¿ç”¨ï¼Œé¿å…æ··ç”¨ `cout` å’Œ `wcout`ï¼Œä»¥ä¿è¯è¾“å‡ºä¸€è‡´æ€§ã€‚

> âš ï¸ æ³¨æ„ï¼Œä½¿ç”¨ g++ ç¼–è¯‘å¸¦`wmain`å‡½æ•°çš„ç¨‹åºæ—¶éœ€è¦åœ¨`-o`å‚æ•°å‰åŠ ä¸Š`-municode`å‚æ•°ï¼Œå¦‚ `g++ test.cpp -municode -o test`ã€‚

------

## ğŸ“ æ€»ç»“å»ºè®®

- Windows ä¸‹ï¼Œ**char\* argv[] ç¼–ç ä¸å¯æ§**ï¼Œæ¨èä½¿ç”¨ `CommandLineToArgvW` é…åˆ `WideCharToMultiByte(CP_UTF8)` è‡ªè¡Œå¤„ç†ã€‚
- æ§åˆ¶å°è¾“å‡ºæ—¶ï¼Œæ¨èä½¿ç”¨ `SetConsoleOutputCP(CP_UTF8)` ç»Ÿä¸€è¾“å‡ºç¼–ç ã€‚
- å¦‚æœä½¿ç”¨å®½å­—ç¬¦æµè¾“å‡ºï¼ˆå¦‚ `wcout`ï¼‰ï¼Œåº”é¢å¤–è°ƒç”¨ `_setmode(_fileno(stdout), _O_U8TEXT)`ã€‚
- **ä¿æŒå…¨ç¨‹åº UTF-8 ç¼–ç ä¸€è‡´æ€§ï¼ˆæºä»£ç ã€å‚æ•°ã€æ–‡ä»¶è¯»å†™ï¼‰æ˜¯å…³é”®**ã€‚

------

## é™„å½•

> # Windowså‘½ä»¤è¡Œå‚æ•°ã€æ§åˆ¶å°ã€ç»ˆç«¯ç­‰ä¹±ç åŸå› è¯¦ç»†åˆ†æ
>
> é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½ä¸€ç‚¹ï¼Œå¯¹äºæ§åˆ¶å°ç¨‹åºï¼Œç”¨æˆ·æ˜¯é€šè¿‡æ§åˆ¶å°æˆ–è€…ç»ˆç«¯ä»¥å‘½ä»¤è¡Œçš„æ–¹å¼ä¸å…¶è¿›è¡Œäº¤äº’çš„ã€‚
>
> **æ§åˆ¶å°ç¨‹åºä¸ç”¨æˆ·ä¹‹é—´çš„äº¤äº’æµç¨‹ï¼š**
>
> ```
> â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ç¨‹åºå¯åŠ¨é˜¶æ®µ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
> 
> ã€€ã€€[ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤è¡Œå‚æ•°ç”±æ§åˆ¶å°å­ç³»ç»Ÿè‡ªåŠ¨å¤„ç†ä¸º UTF-16 å­˜å‚¨åœ¨å…¶å†…éƒ¨ä¾›ç¨‹åºé€šè¿‡ API è¯»å–]
> ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€                     â”‚
> ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€                     â–¼ [GetCommandLineA/GetCommandLineW æ§åˆ¶å° API è·å–å‘½ä»¤è¡Œå‚æ•°]
>                       â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
>                       â•‘       ã€€ CRT åˆå§‹åŒ–ä»£ç           â•‘
>                       â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
>                       â•‘ è°ƒç”¨ GetCommandLineW()        ã€€â•‘ â—„â”€ è·å–åŸå§‹å‘½ä»¤è¡Œ (UTF-16)
>                       â•‘                                â•‘
>                       â•‘ IF å…¥å£æ˜¯ main():               â•‘
>                       â•‘   * ä½¿ç”¨ ACP è½¬æ¢å‘½ä»¤è¡Œ      ã€€ã€€ â•‘ 
>                       â•‘   * åˆ†å‰²ä¸º char* argv[]         â•‘ â—„â”€ ACP (ç³»ç»Ÿæ´»åŠ¨ä»£ç é¡µ)
>                       â•‘   * è°ƒç”¨ main(argc, argv)   ã€€  â•‘ 
>                       â•‘                                â•‘
>                       â•‘ IF å…¥å£æ˜¯ wmain():              â•‘
>                       â•‘   * ç›´æ¥åˆ†å‰²å‘½ä»¤è¡Œ            ã€€ã€€â•‘
>                       â•‘   * è°ƒç”¨ wmain(argc, argv) ã€€   â•‘
>                       â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
> 
> 
> â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ç¨‹åºè¾“å…¥é˜¶æ®µ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                               
>                                [ç”¨æˆ·é”®ç›˜è¾“å…¥/ç²˜è´´]
>                                       â”‚
>                                       â–¼ (è¾“å…¥æ³•å¤„ç†åä¸º UTF-16ï¼Œæ§åˆ¶å°ç¼“å†²åŒºä½¿ç”¨ UTF-16 å¯¹å…¶è¿›è¡Œå­˜å‚¨)
>                        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
>                        â•‘    Windows æ§åˆ¶å°å­ç³»ç»Ÿ      â•‘â—„â”€â”€ ConsoleCP (è®¾ç½®è¾“å…¥ä»£ç é¡µ)
>                        â•‘ ã€€ (conhost.exe æˆ–æ–°ç»ˆç«¯) ã€€ â•‘â—„â”€â”€ ConsoleOutputCP (è®¾ç½®è¾“å‡ºä»£ç é¡µ)
>                        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
>                                       â”‚
>                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
>                 â”‚                                            â”‚
>     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             ã€€ ã€€ã€€â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
>     â”‚ ã€€ã€€ã€€çª„å­—ç¬¦è¾“å…¥    ã€€   â”‚                   â”‚       çª„å­—ç¬¦è¾“å…¥       ã€€â”‚
>     â”‚  (scanf/cin/getchar)  â”‚              ã€€ã€€ã€€â”‚ (wscanf/wcin/getwchar) â”‚
>     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           ã€€   ã€€ã€€â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
>                 â”‚ [ç¨‹åºè°ƒç”¨ ReadConsoleA]                  ã€€ã€€â”‚ [ç¨‹åºè°ƒç”¨ ReadConsoleW] 
>                 â”‚                                       ã€€ã€€ã€€â”‚
>                 â–¼ (å†…éƒ¨è½¬æ¢æµç¨‹)                      ã€€ã€€    ã€€â–¼ (ç›´æ¥è¿”å› UTF-16)  
>      â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                        [è¿”å› wchar_t æ•°æ®]
>      â•‘ 1. è°ƒç”¨ ReadConsoleWã€€â•‘
>      â•‘ 2. ä½¿ç”¨ ConsoleCP   ã€€â•‘
>      â•‘    è½¬æ¢ä¸º ANSI/MBCS   â•‘
>      â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•        
>                 â”‚
>                 â–¼ (è¿”å›è½¬æ¢åæ•°æ®)
>     [è¿”å› char* æ•°æ® (ANSI/MBCS)]
> 
> 
> â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ç¨‹åºè¾“å‡ºé˜¶æ®µ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
> 
>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             ã€€â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
>        â”‚ ã€€ã€€ã€€çª„å­—ç¬¦è¾“å‡º    ã€€   â”‚             ã€€â”‚ ã€€ã€€ã€€å®½å­—ç¬¦è¾“å‡º       ã€€â”‚
>        â”‚ã€€(printf/cout/puts)ã€€ã€€â”‚             ã€€â”‚ (wprintf/wcout/putws) â”‚
>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           ã€€  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
>                   â”‚                                      ã€€â”‚
>                   â”‚ [ç¨‹åºè°ƒç”¨ WriteConsoleA]                â”‚ [ç¨‹åºè°ƒç”¨ WriteConsoleW]
>                   â”‚                                      ã€€â”‚
>      â•”â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•—                         ã€€â–¼ (ç›´æ¥è¾“å‡º UTF-16)
>      â•‘ ã€€ä½¿ç”¨ ConsoleOutputCP   â•‘                   [è¾“å‡º UTF-16 æ•°æ®]
>      â•‘   è½¬æ¢ä¸º UTF-16          â•‘                         ã€€â”‚
>      â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                         ã€€â”‚
>                   â”‚                                      ã€€â”‚
>                   â–¼ (è½¬æ¢åè¾“å‡º)                         ã€€ã€€â”‚ 
>      [è¾“å‡º UTF-16 æ•°æ®]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
>                                      ã€€â–¼
>                         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
>                         â•‘     Windows æ§åˆ¶å°å­ç³»ç»Ÿ     â•‘
>                         â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
>                                        â”‚
>                                        â–¼ (å­—ä½“æ¸²æŸ“)
>                                  [æ§åˆ¶å°æ˜¾ç¤ºå­—ç¬¦]
> 
> â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• å…³é”®æœºåˆ¶è¯´æ˜ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
> 
> 1. å‘½ä»¤è¡Œå‚æ•°ç¼–ç :
>    - wmain(): ç›´æ¥è·å– UTF-16 å‚æ•° (æ— è½¬æ¢)
>    - main(): CRT ä½¿ç”¨ ACP è½¬æ¢ UTF-16 â†’ ANSI/MBCS (å¦‚ä¸­æ–‡ç³»ç»Ÿ GBK)
>      * ä¹±ç æ ¹æº: å½“ç¨‹åºæœŸæœ› UTF-8 ä½†ç³»ç»Ÿ ACP æ˜¯ GBK æ—¶
> 
> 2. æ§åˆ¶å°è¾“å…¥:
>    - ReadConsoleW: ç›´æ¥è¿”å› UTF-16
>    - ReadConsoleA: å†…éƒ¨ä½¿ç”¨ ReadConsoleW + ConsoleCP è½¬æ¢
>      * ConsoleCP é€šè¿‡ `chcp` å‘½ä»¤è®¾ç½®
> 
> 3. æ§åˆ¶å°è¾“å‡º:
>    - WriteConsoleW: ç›´æ¥è¾“å‡º UTF-16
>    - WriteConsoleA: ä½¿ç”¨ ConsoleOutputCP è½¬æ¢ â†’ UTF-16
>      * ConsoleOutputCP é€šè¿‡ `chcp` å‘½ä»¤è®¾ç½®
>      * ä¹±ç æ ¹æº: ç¨‹åºè¾“å‡º UTF-8 ä½† ConsoleOutputCP â‰  65001
> 
> 4. ç°ä»£ç»ˆç«¯ (Windows Terminal) æ³¨æ„äº‹é¡¹:
>    - é»˜è®¤è®¾ç½® ConsoleCP=65001 å’Œ ConsoleOutputCP=65001
>    - ä½† main() å‚æ•°ä»ä¾èµ–ç³»ç»Ÿ ACP (ç‹¬ç«‹è®¾ç½®)
>    - è§£å†³æ–¹æ¡ˆ:
>      * ä½¿ç”¨ wmain() æˆ– CommandLineToArgvW()
>      * è®¾ç½®ç³»ç»Ÿçº§ UTF-8 æ ‡å¿— (Beta åŠŸèƒ½)
>      * è¾“å‡ºæ—¶å§‹ç»ˆä½¿ç”¨ WriteConsoleW æˆ–è®¾ç½® chcp 65001
> ```
>
> å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ**æ§åˆ¶å°ï¼ˆConsoleï¼‰**å’Œ**C è¿è¡Œæ—¶åº“ï¼ˆCRT, C Runtime Libraryï¼‰**æ˜¯ä¸¤ä¸ªä¸åŒçš„ç³»ç»Ÿç»„ä»¶ã€‚
>
> æ§åˆ¶å°ç±»ä¼¼äºç±» Unix ç³»ç»Ÿä¸­çš„â€œç»ˆç«¯â€ï¼Œæ˜¯ç”¨æˆ·ä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„ç•Œé¢ã€‚è€Œ CRT æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„åŸºç¡€åº“ï¼Œå®ƒè´Ÿè´£åˆå§‹åŒ–ç¨‹åºã€å¤„ç†å‘½ä»¤è¡Œå‚æ•°ã€æä¾›è¾“å…¥è¾“å‡ºåŠŸèƒ½ç­‰ã€‚
>
> åœ¨ç”¨æˆ·ä¸ C/C++ ç¨‹åºäº¤äº’çš„è¿‡ç¨‹ä¸­ï¼Œæ§åˆ¶å°èµ·ç€â€œç¿»è¯‘å‘˜â€çš„ä½œç”¨ï¼š
>
> 1. ç”¨æˆ·åœ¨æ§åˆ¶å°ä¸­è¾“å…¥çš„å†…å®¹ï¼Œé¦–å…ˆä¼šæ ¹æ®**æ§åˆ¶å°è¾“å…¥ä»£ç é¡µï¼ˆConsole Input Code Pageï¼‰**è¿›è¡Œç¼–ç è§£æï¼ˆè®¾ç½®å‡½æ•°ä¸º `SetConsoleCP`ï¼‰ï¼Œå¹¶ä»¥ UTF-16 çš„å½¢å¼ä¿å­˜åœ¨å†…éƒ¨ã€‚
> 2. ç¨‹åºå¯åŠ¨æ—¶ï¼ŒCRT å†å°†è¿™æ®µ UTF-16 ç¼–ç çš„æ•°æ®è½¬æ¢ä¸º `char* argv[]` æ‰€éœ€çš„å­—èŠ‚åºåˆ—ã€‚è¿™ä¸€æ­¥ä½¿ç”¨çš„æ˜¯**ç³»ç»Ÿæ´»åŠ¨ä»£ç é¡µï¼ˆACPï¼‰**ï¼Œé€šè¿‡ `WideCharToMultiByte(CP_ACP)` å®ç°ã€‚
>
> å¦‚æœç³»ç»Ÿ ACP æ˜¯ GBKï¼ˆCP936ï¼‰è€Œç”¨æˆ·è¾“å…¥çš„æ˜¯ UTF-8 ç¼–ç ï¼Œå°±ä¼šå¯¼è‡´è½¬æ¢å¤±è´¥æˆ–ä¹±ç ã€‚**è¿™æ­£æ˜¯ç¨‹åºæ”¶åˆ°çš„å‘½ä»¤è¡Œå‚æ•°ä¹±ç çš„æ ¹æºã€‚**
>
> ç¨‹åºè¾“å‡ºæ•°æ®åˆ°æ§åˆ¶å°æ—¶ï¼Œä¹Ÿä¼šç»è¿‡ç±»ä¼¼çš„â€œåå‘ç¿»è¯‘â€æµç¨‹ï¼š
>  ç¨‹åºç”Ÿæˆ UTF-8 æˆ– ACP ç¼–ç çš„æ–‡æœ¬ â†’ CRT è¾“å‡ºå‡½æ•° â†’ æ§åˆ¶å°æ ¹æ®**è¾“å‡ºä»£ç é¡µï¼ˆ`SetConsoleOutputCP`ï¼‰**æ¥è§£æå­—èŠ‚ â†’ ä»¥ UTF-16 æ¸²æŸ“åˆ°æ§åˆ¶å°çª—å£ã€‚ç¼–ç ä¸ä¸€è‡´åŒæ ·ä¼šå¯¼è‡´ä¹±ç ã€‚
>
> ä¾‹å¦‚ï¼š
>
> - å½“ç¨‹åºä½¿ç”¨ `main` è€Œé `wmain` æ—¶ï¼ŒCRT ä¼šå‡å®šå‘½ä»¤è¡Œå‚æ•°æ˜¯ç³»ç»Ÿä»£ç é¡µç¼–ç çš„ï¼Œå¯¼è‡´è¾“å…¥æ˜¯ UTF-8 æ—¶å‡ºé”™ã€‚
> - åŒç†ï¼Œå¦‚æœç¨‹åºé€šè¿‡ `std::cout` è¾“å‡º UTF-8 å­—ç¬¦ä¸²ï¼Œè€Œæ§åˆ¶å°è¾“å‡ºä»£ç é¡µæ˜¯ GBKï¼Œä¹Ÿä¼šä¹±ç ã€‚
>
> å°½ç®¡æˆ‘ä»¬å¯ä»¥é€šè¿‡ `_setmode` ä¿®æ”¹ CRT çš„è¾“å‡ºè¡Œä¸ºï¼Œå¦‚å°† `stdout` è®¾ç½®ä¸º `_O_WTEXT` æˆ– `_O_U8TEXT`ï¼Œä½†**æ— æ³•æ”¹å˜ CRT åœ¨ç¨‹åºå¯åŠ¨å‰è§£æå‘½ä»¤è¡Œå‚æ•°æ—¶çš„è¡Œä¸º** â€”â€” å®ƒä¾æ—§ä½¿ç”¨ç³»ç»Ÿ ACPã€‚
>
> #### å‡ ä¸ªå®ç”¨æç¤ºï¼š
>
> - ä½¿ç”¨ `_setmode(_fileno(stdout), _O_WTEXT)` æ›´ç¨³å¦¥ï¼Œå®ƒè®© `std::wcout` ç›´æ¥è°ƒç”¨ `WriteConsoleW`ï¼ˆæ”¯æŒ UTF-16 è¾“å‡ºï¼‰ï¼Œé¿å…ä¸­é—´è½¬æ¢ï¼Œå…¼å®¹æ€§å’Œæ€§èƒ½éƒ½æ›´å¥½ã€‚
> - `chcp` å‘½ä»¤ç”¨äºä¿®æ”¹æ§åˆ¶å°ä»£ç é¡µï¼š
>   - åœ¨ CMD ä¸­ï¼Œ`chcp` åŒæ—¶å½±å“è¾“å…¥ï¼ˆConsoleCPï¼‰å’Œè¾“å‡ºï¼ˆConsoleOutputCPï¼‰ï¼›
>   - åœ¨ Windows Terminal æˆ– PowerShell ä¸­ï¼Œé€šå¸¸**åªå½±å“è¾“å‡ºä»£ç é¡µ**ï¼Œè¾“å…¥ä»ä½¿ç”¨ç³»ç»Ÿé»˜è®¤æˆ–å¯åŠ¨é…ç½®ã€‚
> - æ§åˆ¶å°**è¾“å…¥ä»£ç é¡µ**ï¼ˆ`SetConsoleCP`ï¼‰å†³å®šç”¨æˆ·è¾“å…¥å¦‚ä½•è½¬æ¢ä¸º UTF-16ï¼›
> - æ§åˆ¶å°**è¾“å‡ºä»£ç é¡µ**ï¼ˆ`SetConsoleOutputCP`ï¼‰å†³å®š CRT è¾“å‡ºå¦‚ä½•è¢«è§£é‡Šæˆæœ€ç»ˆå¯æ˜¾ç¤ºå­—ç¬¦ã€‚